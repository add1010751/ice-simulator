<!DOCTYPE html>
<html lang="zh-tw">
<head>
  <meta charset="UTF-8" />
  <title>å†°æ©Ÿæ¨¡æ“¬å™¨</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    h1 { text-align: center; }
    .controls { text-align: center; margin-bottom: 20px; }
    button { margin: 5px; padding: 10px 20px; font-size: 16px; }
    #result { white-space: pre-line; background: white; padding: 10px; border-radius: 10px; border: 1px solid #ccc; max-height: 300px; overflow-y: auto; }
    .progress { width: 100%; background-color: #ddd; border-radius: 5px; overflow: hidden; margin-top: 20px; }
    .progress-bar { height: 20px; background-color: #4CAF50; width: 0%; text-align: center; color: white; }
    #summary { background: white; padding: 10px; border-radius: 10px; border: 1px solid #ccc; max-height: 300px; overflow-y: auto; margin-top: 20px; }
    li { margin-bottom: 3px; }
    #recentSImages {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
      padding: 6px;
      background: white;
      border-radius: 10px;
      border: 1px solid #ccc;
      max-height: 340px;
      overflow-x: auto;
    }
    #recentSImages img {
      width: 60px;
      height: 60px;
      object-fit: contain;
      border: 1px solid #ccc;
      border-radius: 5px;
      background: #fff;
      cursor: pointer;
    }
    #probabilities {
      margin-top: 40px;
      padding: 10px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <h1>å°å°çš„éºç‰©æŒ«å†°æ©Ÿ(å„ç‘ç»æ–¯çš„å“€æ­Œ)</h1>
  <div class="controls">
    <button onclick="draw(1)">å–®æŠ½</button>
    <button onclick="draw(10)">10é€£æŠ½</button>
    <button onclick="draw(30)">30é€£æŠ½</button>
    <button onclick="draw(100)">100é€£æŠ½</button>
    <button onclick="resetAll()">ğŸ”„ é‡ç½®</button>
  </div>
  <div class="controls">
	<input type="number" id="customDrawCount" placeholder="è¼¸å…¥æŠ½æ•¸" min="1" style="width: 80px; margin-left: 10px;" />
	<button onclick="drawCustom()">é€£æŠ½</button>
  </div>
  
  <div class="progress">
    <div class="progress-bar" id="pityBar">0%</div>
  </div>
  <p>ä¿åº•æ¬¡æ•¸ï¼š<span id="pityCount">0</span></p>
  <p>ç´¯ç©æŠ½æ•¸ï¼š<span id="totalDraws">0</span> æ¬¡</p>
  <p>ç¸½èŠ±è²»ï¼š<span id="totalCost">0</span> å…ƒ (48NT/æŠ½)</p>

  <h3>ç²å¾—çš„[S]é“å…·</h3>
  <div id="recentSImages"></div>

  <h3>æŠ½å–ç´€éŒ„</h3>
  <div id="result"></div>

  <h3>å„çé …ç²å¾—æ¬¡æ•¸çµ±è¨ˆ</h3>
  <ul id="summary"></ul>
  
  <h3>å„çé …æ©Ÿç‡</h3>
  <div id="probabilities">
    <ul id="probabilitiesList"></ul>
  </div>

  <script>
    // [åç¨±, æ©Ÿç‡, ç¨€æœ‰åº¦, åœ–ç‰‡URL]
    const items = [
      ["å„ç‘ç»æ–¯çš„å“€æ­Œæ­¦å™¨ç®±", 0.0045, "S", "https://i.ibb.co/Zpw7tJsC/image.png"],
      ["å„ç‘ç»æ–¯çš„å“€æ­Œä¸Šè¡£ç®±", 0.009, "S", "https://i.ibb.co/DfcwPGF6/image.png"],
      ["å„ç‘ç»æ–¯çš„å“€æ­Œä¸‹è¡£ç®±", 0.009, "S", "https://i.ibb.co/PsJmP40y/image.png"],
      ["å„ç‘ç»æ–¯çš„å“€æ­Œæ‰‹å¥—ç®±", 0.0165, "S", "https://i.ibb.co/SCByhnN/image.png"],
      ["å„ç‘ç»æ–¯çš„å“€æ­Œé‹å­ç®±", 0.0165, "S", "https://i.ibb.co/whFrrJ8D/image.png"],
      ["å„ç‘ç»æ–¯çš„å“€æ­Œé«®å‹ç®±", 0.009, "S", "https://i.ibb.co/Zp0T4vTn/image.png"],
      ["å„ç‘ç»æ–¯çš„å“€æ­Œé£¾å“(å¨ƒå¨ƒ)ç®±", 0.0035, "S", "https://i.ibb.co/0jwb77cP/image.png"],
      ["å„ç‘ç»æ–¯çš„å“€æ­Œé£¾å“(è‡‰ä¸Š)ç®±", 0.0045, "S", "https://i.ibb.co/8DHmQqBM/image.png"],
      ["å„ç‘ç»æ–¯çš„å“€æ­Œé£¾å“(è‡‰ä¸‹)ç®±", 0.0035, "S", "https://i.ibb.co/pv9vCX6C/image.png"],
      ["å„ç‘ç»æ–¯çš„å“€æ­Œé£¾å“(ä¸‹è¡£)ç®±", 0.004, "S", "https://i.ibb.co/ch1WxnY6/image.png"],
      
      ["æ­¦å™¨å°ˆç”¨å¼·åŒ–ç¬¦å’’Lv.10", 0.00001, "S", "https://i.ibb.co/0y8hsBRg/image.png"],
      ["é˜²å…·å°ˆç”¨å¼·åŒ–ç¬¦å’’Lv.10", 0.00001, "S", "https://i.ibb.co/N2ftJCt1/image.png"],
      
      ["è–æˆ°å£«", 0.00001, "S", "https://i.ibb.co/KxhXk6WS/image.png"],
      ["çŠ§ç‰²", 0.00001, "S", "https://i.ibb.co/pvYZh8Jd/image.png"],
      ["å‹åˆ©æ¦®è€€", 0.00001, "S", "https://i.ibb.co/k6HBrGL5/image.png"],
      
      ["é‡‘è‰²é–ƒè€€åœå·¾ç®±", 0.000001, "S", "https://i.ibb.co/5trrzMW/image.png"],
      ["ç¥è–è­·ç¬¦ç®±", 0.000001, "S", "https://i.ibb.co/0pd8kDdV/image.png"],
      ["é˜¿å¡æ©éŠ˜åˆ»", 0.000001, "S", "https://i.ibb.co/cSJCPmnW/image.png"],
      
      ["ç‡¦çˆ›çš„ç§˜å‚³åŸçŸ³", 0.0001, "S", "https://i.ibb.co/spSVmYCC/image.png"],
      ["æ‰è½ç‡70%çç‰Œç®±(1å¤©)", 0.0001, "S", "https://i.ibb.co/33kdrbr/image.png"],
      
      ["è³¢è€…çš„è‡´å‘½ä¸€æ“Šé­”æ³•çŸ³", 0.001, "S", "https://i.ibb.co/9kBB9P5K/image.png"],
      ["è³¢è€…çš„æ¥µå¤§åŒ–é­”æ³•çŸ³", 0.001, "S", "https://i.ibb.co/p61BMXRV/image.png"],
      ["è³¢è€…çš„å‹•ä½œé€Ÿåº¦é­”æ³•çŸ³", 0.001, "S", "https://i.ibb.co/RTZGGT2s/image.png"],
      ["è³¢è€…çš„é¡å¤–å‚·å®³é­”æ³•çŸ³", 0.001, "S", "https://i.ibb.co/zVgpYpnS/image.png"],
      ["è³¢è€…çš„å‚·å®³æ¸›å°‘é­”æ³•çŸ³", 0.001, "S", "https://i.ibb.co/QjKVNLG4/image.png"],
      ["è³¢è€…çš„HPå¢åŠ é­”æ³•çŸ³", 0.001, "S", "https://i.ibb.co/1fyzLKVV/image.png"],
      
      ["æ­¦å™¨è£é£¾ç®±å­", 0.034, "A", ""],
      ["è³¢è€…çš„é­”æ³•çŸ³ç®±(2å€‹)", 0.010597, "A", ""],
      ["è·éšè³¦éˆéŒ„â€“åŠ æˆæ•ˆæœä½¿ç”¨åˆ¸(10å¤©)", 0.00115, "A", ""],
      ["å¤¢å¹»è¶…æŠ€èƒ½åŠ é€Ÿéˆè—¥", 0.0325, "A", ""],
      ["å¤¢å¹»è²å¤šæ–¯çš„ç¿…è†€ç¾½æ¯›éˆè—¥", 0.0325, "A", ""],
      ["æ™‰ç´šæ™‚è£ç®±(15å¤©)", 0.034, "A", ""],
      ["å·¨äººçš„çŸ³è˜‹æœ", 0.02, "B", ""],
      ["è¶…äººçš„æœ‰æ©Ÿè˜‹æœ", 0.02, "B", ""],
      ["ç–¾é¢¨çš„å®‰æœµç¾é”è˜‹æœ", 0.02, "B", ""],
      ["é¬¥å¿—è—¥æ°´", 0.013, "B", ""],
      ["å®Œå…¨æ¢å¾©è—¥æ°´ç®±(100å€‹)", 0.1, "B", ""],
      ["é©æ‡‰éˆè—¥", 0.02, "B", ""],
      ["è‡´å‘½ä¸€æ“Šç‰¹ç´šé­”æ³•çŸ³", 0.01, "B", ""],
      ["å‹•ä½œé€Ÿåº¦ç‰¹ç´šé­”æ³•çŸ³", 0.01, "B", ""],
      ["æ¥µå¤§åŒ–ç‰¹ç´šé­”æ³•çŸ³", 0.01, "B", ""],
      ["HPç‰¹ç´šé­”æ³•çŸ³", 0.01, "B", ""],
      ["å®Œå…¨æ¢å¾©è—¥æ°´ç®±(150å€‹)", 0.04, "B", ""],
      ["è‰¾çˆ¾çš„çµæ™¶(ä¸æ˜)", 0.04, "C", ""],
      ["è‰¾çˆ¾çš„çµæ™¶(ç«)", 0.04, "C", ""],
      ["è‰¾çˆ¾çš„çµæ™¶(æ°´)", 0.04, "C", ""],
      ["è‰¾çˆ¾çš„çµæ™¶(é¢¨)", 0.04, "C", ""],
      ["è‰¾çˆ¾çš„çµæ™¶(åœ°)", 0.04, "C", ""],
      ["è‰¾çˆ¾çš„çµæ™¶(é—‡)", 0.04, "C", ""],
      ["è‰¾çˆ¾çš„çµæ™¶(å…‰)", 0.04, "C", ""],
      ["ç«ä¹‹æ°´æ™¶çƒ300å…¥ç®±", 0.036, "C", ""],
      ["è‡ªç„¶ä¹‹æ°´æ™¶çƒ300å…¥ç®±", 0.036, "C", ""],
      ["æ°´ä¹‹æ°´æ™¶çƒ300å…¥ç®±", 0.036, "C", ""],
      ["é¢¨ä¹‹æ°´æ™¶çƒ300å…¥ç®±", 0.036, "C", ""],
      ["å…‰ä¹‹æ°´æ™¶çƒ300å…¥ç®±", 0.036, "C", ""],
      ["é—‡ä¹‹æ°´æ™¶çƒ300å…¥ç®±", 0.036, "C", ""],
    ];

    const pityRates = { S: 0.10, A: 0.15, B: 0.20, C: 0.40 };
    let pity = 0;
    let pityCount = 0;
    let totalDraws = 0;
    const costPerDraw = 48;

    const stats = {};
    items.forEach(item => stats[item[0]] = 0);

    const recentSImages = [];
    const recentSNames = [];

    function draw(times) {
      let resultArr = [];
      for (let i = 0; i < times; i++) {
        const item = roll();
        totalDraws++;

        if (item[2] === "S" && item[3]) {
          recentSImages.unshift(item[3]);
          recentSNames.unshift(item[0]);
         /* if (recentSImages.length > 100) {
            recentSImages.pop();
            recentSNames.pop();
          }*/
        }

        let line = "";
        if (item[2] === "S") {
          line = `<span style="color:red;">ç¬¬${totalDraws}æŠ½ï¼š[${item[2]}]${item[0]}</span>`;
        } else {
          line = `ç¬¬${totalDraws}æŠ½ï¼š[${item[2]}]${item[0]}`;
        }

        resultArr.push(line);

        pity += pityRates[item[2]];
        stats[item[0]]++;

        if (pity >= 100) {
          pity = 0;
          pityCount++;
          resultArr.push(`<span style="color:blue;">ã€ä¿åº•${pityCount}æ¬¡é”æˆï¼ã€‘ğŸ‰</span>`);
        }
      }

      // åè½‰é™£åˆ—ï¼Œè®“æœ€æ–°æŠ½çé¡¯ç¤ºåœ¨ä¸Šé¢ï¼ˆå€’æ•˜ï¼‰
      resultArr.reverse();

      updateProgress();
      updateStats();
      updateDisplay();
      updateRecentSImages();

      // ç”¨æ›è¡Œä¸²æ¥é¡¯ç¤ºï¼Œä¸”æ–°æŠ½çæ”¾å‰é¢
      document.getElementById("result").innerHTML = resultArr.join("\n") + "<br>" + document.getElementById("result").innerHTML;
    }

    function roll() {
      const rand = Math.random();
      let acc = 0;
      for (const item of items) {
        acc += item[1];
        if (rand < acc) return item;
      }
      return items[items.length - 1];
    }

    function updateProgress() {
      const bar = document.getElementById("pityBar");
      const percent = Math.min(pity, 100).toFixed(2);
      bar.style.width = percent + "%";
      bar.textContent = percent + "%";
      document.getElementById("pityCount").textContent = pityCount;
    }

    function updateStats() {
      const summary = document.getElementById("summary");
      summary.innerHTML = "";
      for (const item of items) {
        const name = item[0];
        const rarity = item[2];
        const count = stats[name];
        if (count > 0) {
          const li = document.createElement("li");
          li.textContent = `[${rarity}] ${name} Ã— ${count}`;
          summary.appendChild(li);
        }
      }
    }

    function updateDisplay() {
      document.getElementById("totalCost").textContent = totalDraws * costPerDraw;
      document.getElementById("totalDraws").textContent = totalDraws;
    }

    function updateRecentSImages() {
      const container = document.getElementById("recentSImages");
      container.innerHTML = "";
      for (let i = 0; i < recentSImages.length; i++) {
        const img = document.createElement("img");
        img.src = recentSImages[i];
        img.title = recentSNames[i];  // æ»‘é¼ ç§»ä¸Šé¡¯ç¤ºåç¨±
        container.appendChild(img);
      }
    }

    function resetAll() {
      pity = 0;
      pityCount = 0;
      totalDraws = 0;
      recentSImages.length = 0;
      recentSNames.length = 0;
      for (const key in stats) stats[key] = 0;
      document.getElementById("result").textContent = "";
      updateProgress();
      updateStats();
      updateDisplay();
      updateRecentSImages();
    }

    function removeTrailingZeros(num) {
      return parseFloat(num.toString());
    }

    window.onload = () => {
      const probDiv = document.getElementById("probabilitiesList");
      probDiv.innerHTML = items.map(item => {
        const rarity = item[2];
        const name = item[0];
        const prob = item[1];
        const probPercent = removeTrailingZeros((prob * 100).toFixed(4));
        return `<div>[${rarity}] ${name} - ${probPercent}%</div>`;
      }).join("");
    }
	
	function drawCustom() {
	  const input = document.getElementById('customDrawCount');
	  let count = parseInt(input.value, 10);

	  if (isNaN(count) || count <= 0) {
		alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„æ­£æ•´æ•¸æŠ½æ•¸");
		return;
	  }
	  
	  // ä½ ä¹Ÿå¯ä»¥è¨­å®šæœ€å¤§é™åˆ¶ï¼Œä¾‹å¦‚10000
	  
	  if (count == 48763) {
		alert("æ˜Ÿçˆ†æ°£æµæ–¬");
	  } else if (count == 114514) {
		alert("ã„ã„ã‚ˆï¼ã“ã„ã‚ˆï¼");
	  } else if (count > 100000) {
		alert("æŠ½æ•¸ä¸èƒ½è¶…é100000");
		return;
	  }
	  
	  

	  draw(count);
	}

  </script>
</body>
</html>
